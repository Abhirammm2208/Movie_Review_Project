<div class="container">
  <section class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div>
        <h1>Find Movie Reviews</h1>
        <p class="muted">Search by movie title to see community reviews.</p>
      </div>
    </div>
    

    <form class="grid cols-2" (ngSubmit)="search()" [formGroup]="searchForm">
      <div class="stack">
        <label for="movie">Movie</label>
        <input id="movie" type="text" placeholder="e.g. Inception" formControlName="movie" />
      </div>
      <div class="stack" style="justify-content:flex-end">
        <button class="btn primary" type="submit">Search reviews</button>
      </div>
    </form>
    <div *ngIf="error()" class="error">{{ error() }}</div>
  </section>

  <section class="card search-results" *ngIf="searchForm.value.movie">
    <div class="search-results-layout">
      <!-- Movie Poster -->
      <div class="search-poster">
        <ng-container *ngIf="searchedPoster(); else posterPlaceholder">
          <img [src]="searchedPoster()" [alt]="searchedMovie()" />
        </ng-container>
        <ng-template #posterPlaceholder>
          <div class="placeholder">{{ searchedMovie() }}</div>
        </ng-template>
      </div>

      <!-- Reviews Section -->
      <div class="search-content">
        <div class="row" style="justify-content:space-between;gap:8px;align-items:center;flex-wrap:wrap">
          <h2 style="margin:0">{{ searchedMovie() }}</h2>
          <a class="btn primary" [routerLink]="['/add-review']" [queryParams]="{ movie: searchedMovie() }">Add review</a>
        </div>

        <div *ngIf="loading()" class="muted" style="margin-top:16px">Loadingâ€¦</div>
        <div *ngIf="!loading() && reviews().length === 0" class="muted" style="margin-top:16px">No reviews yet. Be the first!</div>

        <div class="reviews" *ngIf="reviews().length > 0">
          <div class="card review" *ngFor="let r of reviews()">
            <div class="row" style="gap:12px">
              <div class="avatar">{{ reviewInitials(r) }}</div>
              <div class="badge">{{ r.rating | number:'1.1-1' }}/10</div>
            </div>
            <div>
              <div class="muted">by {{ r.reviewer?.username || 'Anonymous' }}</div>
              <div>{{ r.reviewText }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="row" style="justify-content:space-between;align-items:center;gap:8px">
      <h3>Featured</h3>
      <div class="muted">Click to view reviews or add your own</div>
    </div>
    

    <div class="featured-grid">
      <div class="card" *ngFor="let item of featured">
        <ng-container *ngIf="item.poster; else placeholder">
          <img [src]="item.poster" [alt]="item.title" />
        </ng-container>
        <ng-template #placeholder>
          <div class="placeholder">{{ item.title }}</div>
        </ng-template>
        <div>
          <h3 style="margin:0 0 12px 0">{{ item.title }}</h3>
          <div class="row" style="gap:8px">
            <button class="btn primary" type="button" (click)="addFeatured(item.title)">View reviews</button>
            <a class="btn" [routerLink]="['/add-review']" [queryParams]="{ movie: item.title }">Add review</a>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
